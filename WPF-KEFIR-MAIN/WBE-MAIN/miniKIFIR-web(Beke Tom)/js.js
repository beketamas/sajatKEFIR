let tanulok = [{
    "OM_Azonosito": "78655218932",
    "Neve": "Szabó Anna",
    "ErtesitesiCime": "Budapest, Gellért tér 15.",
    "Email": "anna@example.com",
    "SzuletesiDatum": "1998-07-19T00:00:00",
    "Matematika": 14,
    "Magyar": 35
  },
  {
    "OM_Azonosito": "15963702584",
    "Neve": "Nagy Zsófia",
    "ErtesitesiCime": "Debrecen, Szent István utca 8.",
    "Email": "zsofia@example.com",
    "SzuletesiDatum": "2000-02-22T00:00:00",
    "Matematika": 27,
    "Magyar": 4
  },
  {
    "OM_Azonosito": "30351479261",
    "Neve": "Kovács Máté",
    "ErtesitesiCime": "Szeged, Erzsébet körút 45.",
    "Email": "mate@example.com",
    "SzuletesiDatum": "1995-11-29T00:00:00",
    "Matematika": 48,
    "Magyar": 15
  },
  {
    "OM_Azonosito": "97401028543",
    "Neve": "Tóth Bence",
    "ErtesitesiCime": "Pécs, Váci utca 33.",
    "Email": "bence@example.com",
    "SzuletesiDatum": "1997-03-17T00:00:00",
    "Matematika": 8,
    "Magyar": 47
  },
  {
    "OM_Azonosito": "88765031624",
    "Neve": "Horváth Eszter",
    "ErtesitesiCime": "Székesfehérvár, Bartók Béla út 12.",
    "Email": "eszter@example.com",
    "SzuletesiDatum": "1996-09-08T00:00:00",
    "Matematika": 34,
    "Magyar": 7
  },
  {
    "OM_Azonosito": "64189075351",
    "Neve": "Kiss Attila",
    "ErtesitesiCime": "Miskolc, József Attila utca 18.",
    "Email": "attila@example.com",
    "SzuletesiDatum": "1993-12-05T00:00:00",
    "Matematika": 13,
    "Magyar": 48
  },
  {
    "OM_Azonosito": "18734250658",
    "Neve": "Fekete Laura",
    "ErtesitesiCime": "Győr, Széchenyi tér 9.",
    "Email": "laura@example.com",
    "SzuletesiDatum": "1999-06-30T00:00:00",
    "Matematika": 2,
    "Magyar": 30
  },
  {
    "OM_Azonosito": "51698072427",
    "Neve": "Bíró Gábor",
    "ErtesitesiCime": "Kecskemét, Deák Ferenc utca 21.",
    "Email": "gabor@example.com",
    "SzuletesiDatum": "1994-10-14T00:00:00",
    "Matematika": 9,
    "Magyar": 33
  },
  {
    "OM_Azonosito": "60157349268",
    "Neve": "Mészáros Péter",
    "ErtesitesiCime": "Nyíregyháza, Petőfi Sándor utca 26.",
    "Email": "peter@example.com",
    "SzuletesiDatum": "2001-04-01T00:00:00",
    "Matematika": 36,
    "Magyar": 21
  },
  {
    "OM_Azonosito": "72948316750",
    "Neve": "Varga Noémi",
    "ErtesitesiCime": "Szombathely, Kossuth Lajos utca 3.",
    "Email": "noemi@example.com",
    "SzuletesiDatum": "1992-08-18T00:00:00",
    "Matematika": 24,
    "Magyar": 23
  },
  {
    "OM_Azonosito": "84052731649",
    "Neve": "Lakatos Dóra",
    "ErtesitesiCime": "Veszprém, Ady Endre utca 7.",
    "Email": "dora@example.com",
    "SzuletesiDatum": "2000-01-03T00:00:00",
    "Matematika": 43,
    "Magyar": 41
  },
  {
    "OM_Azonosito": "85273941680",
    "Neve": "Németh Tamás",
    "ErtesitesiCime": "Szolnok, Béke tér 14.",
    "Email": "tamas@example.com",
    "SzuletesiDatum": "1998-05-27T00:00:00",
    "Matematika": 5,
    "Magyar": 49
  },
  {
    "OM_Azonosito": "41593260701",
    "Neve": "Orbán Katalin",
    "ErtesitesiCime": "Eger, Szabadság utca 32.",
    "Email": "katalin@example.com",
    "SzuletesiDatum": "1996-02-11T00:00:00",
    "Matematika": 37,
    "Magyar": 20
  },
  {
    "OM_Azonosito": "10486732952",
    "Neve": "Simon Balázs",
    "ErtesitesiCime": "Debrecen, Király utca 28.",
    "Email": "balazs@example.com",
    "SzuletesiDatum": "1995-07-07T00:00:00",
    "Matematika": 10,
    "Magyar": 48
  },
  {
    "OM_Azonosito": "92740581643",
    "Neve": "Papp Viktória",
    "ErtesitesiCime": "Kaposvár, Alkotmány utca 5.",
    "Email": "viktor@example.com",
    "SzuletesiDatum": "1997-11-24T00:00:00",
    "Matematika": 32,
    "Magyar": 9
  },
  {
    "OM_Azonosito": "10637851454",
    "Neve": "Molnár Zoltán",
    "ErtesitesiCime": "Szekszárd, Párizsi utca 17.",
    "Email": "zoltan@example.com",
    "SzuletesiDatum": "1993-01-16T00:00:00",
    "Matematika": 3,
    "Magyar": 46
  },
  {
    "OM_Azonosito": "44025967885",
    "Neve": "Fekete Márton",
    "ErtesitesiCime": "Pécs, Rákóczi út 13.",
    "Email": "marton@example.com",
    "SzuletesiDatum": "1992-04-29T00:00:00",
    "Matematika": 42,
    "Magyar": 31
  },
  {
    "OM_Azonosito": "30381425616",
    "Neve": "Pál Júlia",
    "ErtesitesiCime": "Sopron, Szent Gellért tér 10.",
    "Email": "julia@example.com",
    "SzuletesiDatum": "1999-09-02T00:00:00",
    "Matematika": 49,
    "Magyar": 19
  },
  {
    "OM_Azonosito": "65082317920",
    "Neve": "Takács Orsolya",
    "ErtesitesiCime": "Eger, Andrássy út 22.",
    "Email": "orsolya@example.com",
    "SzuletesiDatum": "1994-06-13T00:00:00",
    "Matematika": 31,
    "Magyar": 18
  },
  {
    "OM_Azonosito": "15374680221",
    "Neve": "Kovács Ádám",
    "ErtesitesiCime": "Székesfehérvár, Bajnai út 8.",
    "Email": "adam@example.com",
    "SzuletesiDatum": "1996-08-06T00:00:00",
    "Matematika": 18,
    "Magyar": 10
  }];

let felulet = document.getElementById("felulet");
let tablazat = document.getElementById("idLekeres");
let visszaJElzes = document.getElementById("idVisszjelzes");

let ElemekSzama = document.getElementById("idElemekSzama");
let MatekAtlag = document.getElementById("idMatekAtlag");
let MagyarAtlag = document.getElementById("idMagyarAtlag");
let OsszAtlag = document.getElementById("idOsszAtlag");

felulet.innerHTML += `
    <strong style="font-size: 25px;">OM Azonosító kereső</strong>
    <input type="text" placeholder="OM Azonisító" style="height: 2rem;" maxlength="11" onkeypress='return ellenorzesOM(event);' name="OM_Azonosito" id="idOM_Azonosito">
    <input type="text" placeholder="Név" style="height: 2rem;" maxlength="11" onkeydown='return /^[a-zA-Z ]+$/i.test(event.key)' name="Nev" id="idNev">
    <button type="button" id="idKereses" style="font-size: 20px;">Keresés</button>`;


let jelenlegBeirtAzonosiot;
let jelenlegBeirtNev = "";

let kiValaszt = (event) =>{
    let sorok = document.querySelectorAll("tr");
    sorok.forEach(x => {
      x.style.backgroundColor = "";
      x.id = "";
    })
    if (event.target.parentElement.style.backgroundColor == "" && event.target.parentElement.id=="")
    {
      event.target.parentElement.style.backgroundColor = "green";
      event.target.parentElement.id="kivalasztott";
    }
}

function Header(){
    tablazat.innerHTML = "";
    tablazat.innerHTML += `
    <thead>
    <th>OM_Azonosito</th>
    <th>Neve</th>
    <th>Email</th>
    <th>SzuletesiDatum</th>
    <th>Magyar</th>
    <th>Matematika</th>
    </thead>`
}

Header();

function ellenorzesOM(event) {
    if (event.keyCode == 8 || event.keyCode == 46
        || event.keyCode == 37 || event.keyCode == 39) {
           return true;
       }
       else if ( event.keyCode < 48 || event.keyCode > 57 ) {
           return false;
       }
       else return true;
};

let dinamikusKereses_OM = (event) => {
  document.getElementById("idKigyujtTablazat").innerHTML = "",
  ElemekSzama.innerHTML = ``;
  MatekAtlag.innerHTML = ``;
  MagyarAtlag.innerHTML = ``;
  OsszAtlag.innerHTML = ``;
    Header();

    if (parseInt(document.getElementById("idOM_Azonosito").value) != jelenlegBeirtAzonosiot && document.getElementById("idNev").value.toLocaleLowerCase() != jelenlegBeirtNev.toLocaleLowerCase())
      document.getElementById("idKigyujtTablazat").innerHTML = "";

    if (document.getElementById("idNev").value != "") {
      tanulok.forEach(x => {
        if ((x.OM_Azonosito.startsWith(event.target.value) && document.getElementById("idOM_Azonosito").value != "") &&
        (x.Neve.toLocaleLowerCase().startsWith(document.getElementById("idNev").value.toLocaleLowerCase())))
          tablazatFeltoltes(0,x);
    })
    }

    else if(document.getElementById("idNev").value == "" && document.getElementById("idOM_Azonosito").value != ""){
      tanulok.forEach(x => {
        if (x.OM_Azonosito.startsWith(event.target.value))
          tablazatFeltoltes(0,x);
    })
    }

    if(document.getElementById("idOM_Azonosito").value == "" && document.getElementById("idNev").value != ""){
    tanulok.forEach(x => {
        if (x.Neve.toLocaleLowerCase().startsWith(document.getElementById("idNev").value.toLocaleLowerCase()))
          tablazatFeltoltes(0,x);
    })
    }
    
}

let dinamikusKereses_Nev = (event) => {
  document.getElementById("idKigyujtTablazat").innerHTML = "",
  ElemekSzama.innerHTML = ``;
  MatekAtlag.innerHTML = ``;
  MagyarAtlag.innerHTML = ``;
  OsszAtlag.innerHTML = ``;
    Header();
    if (document.getElementById("idNev").value.toLocaleLowerCase() != jelenlegBeirtNev.toLocaleLowerCase() && parseInt(document.getElementById("idOM_Azonosito").value) != jelenlegBeirtAzonosiot)
      document.getElementById("idKigyujtTablazat").innerHTML = "";

    if (document.getElementById("idOM_Azonosito").value != "") {
          tanulok.forEach(x => {
        if ((x.Neve.toLocaleLowerCase().startsWith(event.target.value.toLocaleLowerCase()) && document.getElementById("idNev").value != "") && 
        (x.OM_Azonosito.startsWith(document.getElementById("idOM_Azonosito").value)))
          tablazatFeltoltes(0,x);
    })
    }

    else if(document.getElementById("idOM_Azonosito").value == "" && document.getElementById("idNev").value != ""){
        tanulok.forEach(x => {
        if (x.Neve.toLocaleLowerCase().startsWith(event.target.value.toLocaleLowerCase()))
          tablazatFeltoltes(0,x);
    })
    }
    
    if(document.getElementById("idNev").value == "" && document.getElementById("idOM_Azonosito").value != ""){
      tanulok.forEach(x => {
          if (x.OM_Azonosito.startsWith(document.getElementById("idOM_Azonosito").value))
            tablazatFeltoltes(0,x);
      })
    }

}

document.getElementById("idOM_Azonosito").addEventListener("input",dinamikusKereses_OM)
document.getElementById("idNev").addEventListener("input", dinamikusKereses_Nev)

document.getElementById("idKigyujt").addEventListener("click", () => {
    let masikTablazat = document.getElementById("idKigyujtTablazat");
    masikTablazat.innerHTML = "";
    let sor = document.getElementById('kivalasztott');
    if (sor == undefined) {
      alert("Jelöljön ki egy elemet!");
    }
    else{
      tanulok.forEach(x => {
          if (parseInt(x.Matematika) + parseInt(x.Magyar) > parseInt(sor.getElementsByTagName("td")[4].innerHTML) + parseInt(sor.getElementsByTagName("td")[5].innerHTML)) {
              let sor = document.createElement("tr");
              sor.innerHTML = `
              <td>${x.OM_Azonosito}</td>
              <td>${x.Neve}</td>
              `;
              masikTablazat.appendChild(sor);
          }
      })
    }
})


document.getElementById("idKereses").addEventListener("click", () => {
  document.getElementById("idKereses").classList.remove("redButtonBorder");
  let cellak = document.querySelectorAll("td");
  let talalatiLista = [];
  let matekAtlag = 0;
  let magyarAtlag = 0;
  let osszAtlag = 0;

  if (cellak.length == 0)
    alert("Nem létezik ilyen OM Azonosító vagy Név!");
  else{
    Header();
    let omAzonosito = document.getElementById("idOM_Azonosito").value;
    let nev = document.getElementById("idNev").value;
    tanulok.forEach(x => {
      if (omAzonosito == "") {
        if (x.Neve.toLocaleLowerCase().startsWith(nev.toLocaleLowerCase()))
        {
        matekAtlag += parseFloat(x.Matematika);
        magyarAtlag += parseFloat(x.Magyar);
        osszAtlag += parseFloat(x.Magyar) + parseFloat(x.Matematika);
        talalatiLista.push(x);
        tablazatFeltoltes(1,x);
        }
      }
      else if (nev == "") {
        if (x.OM_Azonosito.startsWith(omAzonosito))
        {
        matekAtlag += parseFloat(x.Matematika);
        magyarAtlag += parseFloat(x.Magyar);
        osszAtlag += parseFloat(x.Magyar) + parseFloat(x.Matematika);
        talalatiLista.push(x);
        tablazatFeltoltes(1,x);
        }
      }
      else{
        if (x.OM_Azonosito.startsWith(omAzonosito) && x.Neve.toLocaleLowerCase().startsWith(nev.toLocaleLowerCase()))
        {
        matekAtlag += parseFloat(x.Matematika);
        magyarAtlag += parseFloat(x.Magyar);
        osszAtlag += parseFloat(x.Magyar) + parseFloat(x.Matematika);
        talalatiLista.push(x);
        tablazatFeltoltes(1,x);
        }
      }
    })
    jelenlegBeirtAzonosiot = parseInt(omAzonosito);
    jelenlegBeirtNev = nev;
    ElemekSzama.innerHTML = `${talalatiLista.length}`;
    MatekAtlag.innerHTML = `${Math.round(matekAtlag / talalatiLista.length * 10) / 10 }`;
    MagyarAtlag.innerHTML = `${Math.round(magyarAtlag / talalatiLista.length * 10) / 10 }`;
    OsszAtlag.innerHTML = `${Math.round(osszAtlag  / (talalatiLista.length * 2) * 10) / 10 }`;
  }
})

let tablazatFeltoltes = (feltoltesTipusa,x) => {
  let sor = document.createElement("tr");
  if (feltoltesTipusa === 0)
  {
    sor.style.opacity = 0.5;
    sor.style.filter = "blur(1px)";
    document.getElementById("idKereses").classList.add("redButtonBorder");
  }
  else if(feltoltesTipusa === 1)
    sor.addEventListener("click", kiValaszt);
  sor.innerHTML= `
  <td>${x.OM_Azonosito}</td>
  <td>${x.Neve}</td>
  <td>${x.Email}</td>
  <td>${new Date(x.SzuletesiDatum).getFullYear()}-${new Date(x.SzuletesiDatum).getMonth()}-${new Date(x.SzuletesiDatum).getDay()}</td>
  <td>${x.Magyar}</td>
  <td>${x.Matematika}</td>
  `;
  tablazat.appendChild(sor);  
}